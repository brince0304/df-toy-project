<!DOCTYPE html>
<html lang="ko">
<head>
    <link href="/Login/assets/css/main.css" rel="stylesheet"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link th:href="@{/Login/assets/css/bootstrap.css}" rel="stylesheet"/>
    <meta charset="UTF-8">
    <script src="https://kit.fontawesome.com/1d4d31d2f3.js" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link th:href="@{/Login/assets/css/login-register.css}" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/header/fonts/icomoon/style.css">

    <link rel="stylesheet" href="/header/css/owl.carousel.min.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/header/css/bootstrap.min.css">
    <!-- Style -->
    <link rel="stylesheet" href="/header/css/style.css">

    <link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.3.1/css/all.css'>
    <title>Title</title>
    <style>


    </style>
</head>
<body>
<header id="header">
    헤더
</header>
<div class="container" style="margin-top : 92px">
    <div class="card mt-5 border-5 pt-2 active pb-0 px-3">
        <div class="card-body ">
            <div class="row">
                <div class="col-12 ">
                    <h4 class="card-title "><b th:text="${user.nickname()} +'님 환영합니다!'">Program Title</b></h4>

                </div>
                <div class="col">
                    <h6 class="card-subtitle mb-2 text-muted">
                        <p class="card-text text-muted small ">
                            <img src="https://img.icons8.com/metro/26/000000/star.png" class="mr-1 " width="19"
                                 height="19" id="star"> <span class="vl mr-2 ml-0"></span>

                            <span class="font-weight-bold">아이디 : </span><span
                                th:text="${user.userId()}+' 이메일 : '+${user.email()}"></span></p>
                    </h6>
                </div>
            </div>

        </div>

        <div class="card-footer bg-white px-0 ">
            <div class="row">

                <div class=" col-md-auto ">
                    <a class="btn btn-outlined btn-black text-muted bg-transparent"
                       data-wow-delay="0.7s" data-toggle="modal" href="#"
                       data-target="#detailModifyModal"><img src="https://img.icons8.com/ios/50/000000/settings.png"
                                                             width="19" height="19"> <small>정보 수정</small></a>

                    <i class="mdi mdi-settings-outline"></i>


                    <a href="#" class="btn btn-outlined btn-black text-muted" data-toggle="modal"
                       data-target="#charSearchModal">
                        <img src="https://img.icons8.com/metro/26/000000/link.png" width="20" height="20">
                        <small>캐릭터 등록</small> </a>


                    <a href="#" class="btn btn-outlined btn-black text-muted "><img
                            src="https://img.icons8.com/metro/26/000000/more.png" width="20" height="20"
                            class="mr-2 more"><small> 활동 내역</small></a>
                </div>

                <div class="col-md-auto ">
                    <ul class="list-inline">
                        <li class="list-inline-item"><a data-toggle="modal"
                                                        data-target="#iconSelectModal" href="#" class="
                         btn btn-outlined btn-black text-muted"> <img
                                th:src="@{/api/getFile.df(name=${user.profileIcon().fileName()})}" src=""
                                alt="DP" class="  rounded-circle img-fluid " width="20" height="20"> <small>프로필 아이콘
                            변경</small> </a>
                        </li>
                        <li class="list-inline-item"><a data-toggle="modal"
                                                        data-target="#iconSelectModal" href="#" class="
                         btn btn-outlined btn-black text-muted">  <small>모험단 등록</small> </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <br>
    <br>
    <div class="row">
        <div class="col-12">
            <div class="card card-margin">
                <div class="card-body">
                    <div class="row search-body">
                        <div class="col-lg-12">
                            <div class="search-result">
                                <div class="result-body">
                                    <div class="table-responsive" style="border:none;">
                                        <div th:if="${characters.isEmpty()}">
                                            <div style="text-align: center; margin-top: 50px; margin-bottom: 50px">
                                                <i class="fa-solid fa-skull-crossbones" style="font-size: 60px"></i>
                                                <div style="font-size: 20px; font-weight: 500; color: #999999; margin-top: 20px">캐릭터가 존재하지 않습니다.</div>
                                            </div>
                                        </div>
                                        <div class="container">
                                            <div class="row charThumb" style="margin-left:-20px">
                                                <!-- Single Advisor-->
                                                <div th:each="char : ${characters}" class="col-12 col-sm-6 col-lg-3">
                                                    <div class="single_advisor_profile wow fadeInUp characterCard"
                                                         data-wow-delay="0.2s"
                                                         style="background-image: url('/images/icon_char/bg_char.jpeg') ;   background-repeat: no-repeat;   background-position: center;
                                                            background-size: cover;">
                                                        <div style="">
                                                        <!-- Team Thumb-->
                                                        <span class="badge bg-light text-dark" style="float:left">
                                                            <img class="icon-fame"
                                                                 th:src="@{/images/icon_char/icon_status_fame.png}"
                                                                 src="" alt="fame"
                                                                 style=""> <small
                                                                style=" display:inline; color: #d39e00"
                                                                th:text="${char.adventureFame}"></small> </span>
                                                        <span class="badge bg-light text-dark" type="button"
                                                              th:data-id="${char.characterId}"
                                                              th:data-server="${char.serverId}"
                                                              th:onclick="deleteCharacter(this.getAttribute('data-server') , this.getAttribute('data-id'))"
                                                              style="display:inline ; float:right; ">삭제</span></div>
                                                        <div class="advisor_thumb">
                                                            <img th:src="@{'https://img-api.neople.co.kr/df/servers/'+${char.serverId}+'/characters/' + ${char.characterId} + '?zoom=2'}"
                                                                 src="" style="scale:1.7" alt="">
                                                            <!-- Social Info-->
                                                        </div>
                                                        <!-- Team Details-->
                                                        <div class="single_advisor_details_info"
                                                             style="text-align: left">
                                                            <h4 style="color: #898989;" th:text="${char.getServerName(char.serverId)}"
                                                                id="charServerId"></h4>
                                                            <h6 th:text="${char.characterName}">
                                                                Samantha Sarah</h6>
                                                            <p style="color: #898989" th:text="${char.jobGrowName}"></p>
                                                            <p class="designation" style="color: #898989"
                                                               th:text="${char.adventureName}">
                                                            </p>
                                                            <p style="display:inline"
                                                               th:text=" 'Lv.'+${char.level}"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="charSearchModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2" style="margin-left:2%"
         aria-hidden="true">
        <div class="modal-dialog" style="max-width:500px" role="document">
            <div class="modal-content" style="    border: 1px solid rgba(0,0,0,.2);">
                <div class="modal-header" style="padding: 5px;">
                    <div class="input-group" style="z-index: 1;">
                        <div class="input-group">
                            <select name="serverId" id="serverId">
                                <option value="all">전체</option>
                                <option value="adventure">모험단</option>
                                <option value="cain">카인</option>
                                <option value="diregie">디레지에</option>
                                <option value="siroco">시로코</option>
                                <option value="prey">프레이</option>
                                <option value="casillas">카시야스</option>
                                <option value="hilder">힐더</option>
                                <option value="anton">안톤</option>
                                <option value="bakal">바칼</option>
                            </select>
                            <input type="text" placeholder="입력" class="form-control" id="characterName"
                                   name="characterName">
                            <button type="button" class="btn btn-info" style="height:39px;" id="btn-search" href="#"
                                    onclick="searchCharacter()">검색
                            </button>
                        </div>
                    </div>
                </div>
                <div id="searchBody" class="modal-body" style="min-height: 300px; max-height: 500px; overflow: auto;">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="detailModifyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" style="max-width:500px" role="document">
            <div class="modal-content" style="    border: 1px solid rgba(0,0,0,.2);">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel0">정보를 수정합니다!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="position: relative;
    flex: 1 1 auto;
    padding: 1rem;">
                    <label for="nicknameUpdate" style="color: #898989;">닉네임</label>
                    <div class="input-group mb-3" id="nicknameUpdateForm">
                        <input type="text" class="form-control" id="nicknameUpdate" placeholder="새 닉네임을 입력해주세요.">
                        <button class="btn btn-outline-secondary" type="button" id="nicknameUpdateBtn"
                                onclick="updateNickname()">변경
                        </button>
                        <div class="valid-feedback" id="nicknameUpdateVal">사용 가능한 닉네임 입니다.</div>
                        <div class="invalid-feedback" id="nicknameUpdateNonVal">중복된 닉네임이 존재합니다.</div>
                    </div>
                    <label for="passwordUpdate" style="color: #898989;">비밀번호</label>
                    <div class="input-group mb-3" id="passwordUpdateForm">
                        <input type="text" class="form-control" id="passwordUpdate" placeholder="새로운 비밀번호를 입력해주세요.">
                    </div>
                    <label for="passwordCheckUpdate" style="color: #898989;">비밀번호 확인</label>
                    <div class="input-group mb-3" id="passwordUpdateForm">
                        <input type="text" class="form-control" id="passwordCheckUpdate" placeholder="비밀번호를 재입력 해주세요.">
                        <button class="btn btn-outline-secondary" type="button" id="passwordUpdateBtn"
                                onclick="updatePassword()">변경
                        </button>
                        <div class="valid-feedback" id="passwordUpdateVal">사용 가능한 비밀번호 입니다.</div>
                        <div class="invalid-feedback" id="passwordUpdateNonVal">비밀번호가 일치하지 않습니다.</div>
                    </div>
                    <label for="emailUpdate" style="color: #898989;">이메일</label>
                    <div class="input-group mb-3" id="emailUpdateForm">
                        <input type="text" class="form-control" id="emailUpdate" placeholder="새 이메일을 입력해주세요.">
                        <button class="btn btn-outline-secondary" type="button" id="emailUpdateBtn"
                                onclick="updateEmail()">변경
                        </button>
                        <div class="valid-feedback" id="emailUpdateVal">사용 가능한 이메일 입니다.</div>
                        <div class="invalid-feedback" id="emailUpdateNonVal">중복된 이메일이 존재합니다.</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="iconSelectModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" style="max-width:500px" role="document">
            <div class="modal-content" style="    border: 1px solid rgba(0,0,0,.2);">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel1">환영합니다!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="position: relative;
    flex: 1 1 auto;
    padding: 1rem;">
                    <span style="color: #898989;"> 변경을 원하는 아이콘을 선택해주세요!</span>
                    <ul class="ub p-0 mt-3 mb-3" style="    margin: 0;
    display: inline-table; box-sizing: border-box;">
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(0)"> <img
                                    th:src="@{/images/icon_char/icon_char_0.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(1)"> <img
                                    th:src="@{/images/icon_char/icon_char_1.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(2)"> <img
                                    th:src="@{/images/icon_char/icon_char_2.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(3)"> <img
                                    th:src="@{/images/icon_char/icon_char_3.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(4)"> <img
                                    th:src="@{/images/icon_char/icon_char_4.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(5)"> <img
                                    th:src="@{/images/icon_char/icon_char_5.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(6)"> <img
                                    th:src="@{/images/icon_char/icon_char_6.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(7)"> <img
                                    th:src="@{/images/icon_char/icon_char_7.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(8)"> <img
                                    th:src="@{/images/icon_char/icon_char_8.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(9)"> <img
                                    th:src="@{/images/icon_char/icon_char_9.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(10)"> <img
                                    th:src="@{/images/icon_char/icon_char_10.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(11)"> <img
                                    th:src="@{/images/icon_char/icon_char_11.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(12)"> <img
                                    th:src="@{/images/icon_char/icon_char_12.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(13)"> <img
                                    th:src="@{/images/icon_char/icon_char_13.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(14)"> <img
                                    th:src="@{/images/icon_char/icon_char_14.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>
                        <li>
                            <a class="userIcon btn-outlined btn-black text-muted" href="#"
                               onclick="changeProfileIcon(15)"> <img
                                    th:src="@{/images/icon_char/icon_char_15.png}" src=""
                                    alt="DP" class="  rounded-circle img-fluid " width="28" height="28"></a>
                        </li>


                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>

</div>
<footer id="footer">
    푸터
</footer>
<script src="/header/js/jquery.sticky.js"></script>
<script src="/header/js/main.js"></script>
<script src="https://code.jquery.com/jquery-3.6.1.js"></script>
<!-- Popper JS -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js'></script>
<!-- Bootstrap JS -->
<script src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js'></script>
</body>
<script>
    let emailCheck = false;
    let nicknameCheck = false;
    let passwordBooleanCheck = false;

    function changeProfileIcon(number) {
        if (confirm("아이콘을 변경하시겠습니까?")) {
            const iconName = "icon_char_" + number + ".png";
            $.ajax({
                url: "/api/user/profile.df?profileIcon=" + iconName,
                type: "PUT",
                data: {
                    iconNumber: number
                },
                success: function (data) {

                    alert("아이콘 변경이 완료되었습니다.");
                    location.reload();
                },
                error: function (request, status, error) {
                    alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                }
            });
        } else {
            return;
        }
    }

    // Mobile Navigation
    if ($('#nav-menu-container').length) {
        var $mobile_nav = $('#nav-menu-container').clone().prop({
            id: 'mobile-nav'
        });
        $mobile_nav.find('> ul').attr({
            'class': '',
            'id': ''
        });
        $('body').append($mobile_nav);
        $('body').prepend('<button type="button" id="mobile-nav-toggle"><i class="fa fa-bars"></i></button>');
        $('body').append('<div id="mobile-body-overly"></div>');
        $('#mobile-nav').find('.menu-has-children').prepend('<i class="fa fa-chevron-down"></i>');

        $(document).on('click', '.menu-has-children i', function (e) {
            $(this).next().toggleClass('menu-item-active');
            $(this).nextAll('ul').eq(0).slideToggle();
            $(this).toggleClass("fa-chevron-up fa-chevron-down");
        });

        $(document).on('click', '#mobile-nav-toggle', function (e) {
            $('body').toggleClass('mobile-nav-active');
            $('#mobile-nav-toggle i').toggleClass('fa-times fa-bars');
            $('#mobile-body-overly').toggle();
        });

        $(document).click(function (e) {
            var container = $("#mobile-nav, #mobile-nav-toggle");
            if (!container.is(e.target) && container.has(e.target).length === 0) {
                if ($('body').hasClass('mobile-nav-active')) {
                    $('body').removeClass('mobile-nav-active');
                    $('#mobile-nav-toggle i').toggleClass('fa-times fa-bars');
                    $('#mobile-body-overly').fadeOut();
                }
            }
        });
    } else if ($("#mobile-nav, #mobile-nav-toggle").length) {
        $("#mobile-nav, #mobile-nav-toggle").hide();
    }

    // Smooth scroll for the menu and links with .scrollto classes
    $('.nav-menu a, #mobile-nav a, .scrollto').on('click', function () {
        if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
            var target = $(this.hash);
            if (target.length) {
                var top_space = 0;

                if ($('#header').length) {
                    top_space = $('#header').outerHeight();

                    if (!$('#header').hasClass('header-fixed')) {
                        top_space = top_space - 20;
                    }
                }

                $('html, body').animate({
                    scrollTop: target.offset().top - top_space
                }, 1500, 'easeInOutExpo');

                if ($(this).parents('.nav-menu').length) {
                    $('.nav-menu .menu-active').removeClass('menu-active');
                    $(this).closest('li').addClass('menu-active');
                }

                if ($('body').hasClass('mobile-nav-active')) {
                    $('body').removeClass('mobile-nav-active');
                    $('#mobile-nav-toggle i').toggleClass('fa-times fa-bars');
                    $('#mobile-body-overly').fadeOut();
                }
                return false;
            }
        }
    });

    $('#nicknameUpdate').blur(function () {
        const nickname = $('#nicknameUpdate').val();
        $.ajax({
            url: "/api/user/validate?nickname=" + nickname,
            type: "GET",
            success: function (data) {
                if (data === "true") {
                    $('#nicknameUpdateForm').addClass('was-validated');
                    $('#nicknameUpdate').removeClass("is-invalid");
                    $('#nicknameUpdate').addClass("is-valid");
                    $('#nicknameUpdateNonVal').hide();
                    $('#nicknameUpdateVal').show();
                    nicknameCheck = true;
                } else if (data === "false") {
                    $('#nicknameUpdateForm').removeClass('was-validated');
                    $('#nicknameUpdate').removeClass("is-valid");
                    $('#nicknameUpdate').addClass("is-invalid");
                    $('#nicknameUpdateVal').hide();
                    $('#nicknameUpdateNonVal').show();
                    nicknameCheck = false;
                }

            }, error: function (request, status, error) {
                alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
            }
        });
    });

    $('#emailUpdate').blur(function () {
        const email = $('#emailUpdate').val();
        $.ajax({
            url: "/api/user/validate?email=" + email,
            type: "GET",
            success: function (data) {
                if (data === "true") {
                    $('#emailUpdateForm').addClass('was-validated');
                    $('#emailUpdate').removeClass("is-invalid");
                    $('#emailUpdate').addClass("is-valid");
                    $('#emailUpdateNonVal').hide();
                    $('#emailUpdateVal').show();
                    emailCheck = true;
                } else if (data === "false") {
                    $('#emailUpdateForm').removeClass('was-validated');
                    $('#emailUpdate').removeClass("is-valid");
                    $('#emailUpdate').addClass("is-invalid");
                    $('#emailUpdateVal').hide();
                    $('#emailUpdateNonVal').show();
                    emailCheck = false;
                }

            }, error: function (request, status, error) {
                alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
            }
        });
    });

    $('#passwordCheckUpdate').blur(function () {
        const password = $('#passwordUpdate').val();
        let passwordCheck = $('#passwordCheckUpdate').val();

        if (password !== passwordCheck) {
            $('#passwordCheckUpdateForm').removeClass('was-validated');
            $('#passwordCheckUpdate').removeClass("is-valid");
            $('#passwordCheckUpdate').addClass("is-invalid");
            $('#passwordCheckUpdateVal').hide();
            $('#passwordCheckUpdateNonVal').show();
            $('#passwordUpdate').removeClass("is-valid");
            $('#passwordUpdate').addClass("is-invalid");
            passwordBooleanCheck = false;
        } else {
            $('#passwordCheckUpdateForm').addClass('was-validated');
            $('#passwordCheckUpdate').addClass("is-valid");
            $('#passwordCheckUpdate').removeClass("is-invalid");
            $('#passwordUpdate').addClass("is-valid");
            $('#passwordUpdate').removeClass("is-invalid");
            $('#passwordCheckUpdateVal').show();
            $('#passwordCheckUpdateNonVal').hide();
            passwordBooleanCheck = true;
        }
    });

    $('#passwordUpdate').blur(function () {
        const password = $('#passwordUpdate').val();
        const passwordCheck = $('#passwordCheckUpdate').val();

        if (password !== passwordCheck) {
            $('#passwordCheckUpdateForm').removeClass('was-validated');
            $('#passwordCheckUpdate').removeClass("is-valid");
            $('#passwordCheckUpdate').addClass("is-invalid");
            $('#passwordCheckUpdateVal').hide();
            $('#passwordCheckUpdateNonVal').show();
            $('#passwordUpdate').removeClass("is-valid");
            $('#passwordUpdate').addClass("is-invalid");
            passwordBooleanCheck = false;
        } else {
            $('#passwordCheckUpdateForm').addClass('was-validated');
            $('#passwordCheckUpdate').addClass("is-valid");
            $('#passwordCheckUpdate').removeClass("is-invalid");
            $('#passwordUpdate').addClass("is-valid");
            $('#passwordUpdate').removeClass("is-invalid");
            $('#passwordCheckUpdateVal').show();
            $('#passwordCheckUpdateNonVal').hide();
            passwordBooleanCheck = true;
        }
    });

    function updatePassword() {
        const password = $('#passwordUpdate').val();
        if (!passwordBooleanCheck) {
            alert("비밀번호가 일치하지 않습니다.");
            return;
        } else if (confirm("비밀번호를 변경하시겠습니까?")) {
            $.ajax({
                url: "/api/user/profile.df?password=" + password,
                type: "PUT",
                success: function (data) {
                    alert("비밀번호가 변경되었습니다.");
                    $('#passwordUpdate').val("");
                    $('#passwordCheckUpdate').val("");
                    $('#passwordCheckUpdateForm').removeClass('was-validated');
                    $('#passwordCheckUpdate').removeClass("is-valid");
                    passwordBooleanCheck = false;
                    location.reload();
                }, error: function (request, status, error) {
                    alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                }
            });
        }

    }

    function updateEmail() {
        const email = $('#emailUpdate').val();
        if (!emailCheck) {
            alert("중복된 이메일입니다.");
            return;
        } else if (confirm("이메일을 변경하시겠습니까?")) {
            $.ajax({
                url: "/api/user/profile.df?email=" + email,
                type: "PUT",
                success: function (data) {
                    alert("이메일이 변경되었습니다.");
                    $('#emailUpdate').val("");
                    $('#emailUpdateForm').removeClass('was-validated');
                    $('#emailUpdate').removeClass("is-valid");
                    emailCheck = false;
                    location.reload();

                }, error: function (request, status, error) {
                    alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                }
            });
        }

    }

    function updateNickname() {
        const nickname = $('#nicknameUpdate').val();
        if (!nicknameCheck) {
            alert("중복된 닉네임입니다.");
            return;
        } else if (confirm("닉네임을 변경하시겠습니까?")) {
            $.ajax({
                url: "/api/user/profile.df?nickname=" + nickname,
                type: "PUT",
                success: function (data) {
                    alert("닉네임이 변경되었습니다.");
                    $('#nicknameUpdate').val("");
                    $('#nicknameUpdateForm').removeClass('was-validated');
                    $('#nicknameUpdate').removeClass("is-valid");
                    nicknameCheck = false;
                    location.reload();

                }, error: function (request, status, error) {
                    alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                }
            });
        }

    }

    $('#searchModal').on('show.bs.modal', function (e) {
        search_modal_type = $(e.relatedTarget).attr('data-type');
    });

    function getServerName(serverId) {
        switch (serverId) {
            case "cain":
                return "카인";
                break;
            case "diregie":
                return "디레지에";
                break;
            case "siroco":
                return "시로코";
                break;
            case "prey":
                return "프레이";
                break;
            case "casillas":
                return "카시야스";
                break;
            case "hilder":
                return "힐더";
                break;
            case "anton":
                return "안톤";
                break;
            case "bakal":
                return "바칼";
                break;
        }
    }

    function searchCharacter() {
        const characterName = $('#characterName').val();
        const serverId = $('#serverId').val();
        $.ajax({
            url: "/api/user/searchChar.df?page=0&serverId=" + serverId + "&characterName=" + characterName,
            type: "GET",
            success: function (data) {
                if (data == null) {
                    alert("캐릭터를 찾을 수 없습니다.");
                    return;
                } else {
                    setSearchModalResult(data);
                }
            }, error: function (request, status, error) {
            }
        });
    }

    function setSearchModalResult(list) {
        if (list.length > 0) {
            var html = '<table class="table table-striped table-hover" style="text-align: center;">';
            html += '<thead style="font-weight: bold;"><tr><td>서버</td><td>닉네임</td>';
            if (list[0].level != undefined) {
                html += '<td>레벨</td>';
            }
            html += '<td>직업</td></tr></thead>';
            html += '<tbody>';
            for (var i = 0; i < list.length; i++) {
                html += ' <tr class="search-item" data-server="' + list[i].serverId + '" data-id="' + list[i].characterId + '" data-name="' + list[i].characterName + '" onclick="setCharacter( \'' + list[i].serverId + '\', \'' + list[i].characterId + '\')">';
                html += '<td>' + getServerName(list[i].serverId) + "</td>";
                html += '<td>' + list[i].characterName + "</td>";
                if (list[i].level != undefined) {
                    html += '<td>' + list[i].level + "</td>";
                }
                html += '<td>' + list[i].jobGrowName + "</td>";
                html += '</tr>';
            }
            html += '</tbody>';
            html += "</table>";
            $('#searchBody').html(html);
        } else {
            var html = '<h3 style="text-align: center;">검색 결과가 없습니다.</h3>';
            $('#searchBody').html(html);
        }
    }

    function setCharacter(serverId, characterId) {

        if (confirm("캐릭터를 추가하시겠습니까?")) {
            $.ajax({
                url: "/api/user/char.df?characterId=" + characterId + "&serverId=" + serverId + "&request=add",
                type: "POST",
                success: function (data) {
                    alert("캐릭터가 추가되었습니다.");
                    $('#searchModal').modal('hide');
                    location.reload();
                }, error: function (request, status, error) {
                    alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                }
            });
        }
    }


    function deleteCharacter(serverId,characterId) {

        if (confirm("캐릭터를 삭제하시겠습니까?")) {
            $.ajax({
                url: "/api/user/char.df?serverId="+serverId +"&characterId=" + characterId + "&request=delete",
                type: "POST",
                success: function (data) {
                    alert("캐릭터가 삭제되었습니다.");
                    location.reload();
                }, error: function (request, status, error) {
                    alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                }
            });
        }
    }

    $(document).ready(function () {
        $('#charServerId').change(function () {
            const serverId = $(this).val();
            $('#charServerId').val(getServerName(serverId));
        });
    })

    function pic() {
        var bgm = ['/images/icon_char/bg_char.jpeg', '/images/icon_char/bg_char_02.png', '/images/icon_char/bg_char_03.png'];
        $('.characterCard').css({
            'background': 'url(' + bgm[Math.floor(Math.random() * bgm.length)] + ') no-repeat',
            'background-position': 'center',
            'background-size': 'cover'
        });
    }

    pic();
    $(function () {
        $('#characterName').keypress(function (e) {
            if (e.keyCode == 13) {
                searchCharacter();

            }
        });


    });

    function logoutAlert(){
        $.ajax({
            url: "/api/user/logout",
            type: "POST",
            success: function (data) {
                console.log(data);
                alert("로그아웃 되었습니다.");
                location.reload();
            }
        });
    }
</script>
</html>