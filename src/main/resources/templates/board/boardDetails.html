<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet"/>
    <link href="/css/searchForm.css" rel="stylesheet"/>
    <link href="/Login/assets/css/bootstrap.css" rel="stylesheet"/>
    <meta charset="UTF-8">
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <script src="https://kit.fontawesome.com/1d4d31d2f3.js" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="/Login/assets/css/login-register.css" rel="stylesheet"/>
    <link href="/Login/assets/css/main.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css"/>
    <link rel="stylesheet" href="/css/owl.carousel.min.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/header/fonts/icomoon/style.css">

    <link rel="stylesheet" href="/header/css/owl.carousel.min.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/header/css/bootstrap.min.css">
    <!-- Style -->
    <link rel="stylesheet" href="/header/css/style.css">
    <link rel="stylesheet" href="/header/css/style.css">
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <script src="/Login/assets/js/bootstrap.js" type="text/javascript"></script>
    <script src="/Login/assets/js/login-register.js" type="text/javascript"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.3.1/css/all.css'>
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <!-- TOAST UI Editor CDN(CSS) -->
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css"/>
    <title>던파모아 온오프</title>
    <style>
        .wrap {
            width: 500px;
        }
        .wrap textarea {
            width: 90%;
            resize: none;
            overflow-y: hidden; /* prevents scroll bar flash */
            padding: 1.1em; /* prevents text jump on Enter keypress */
            padding-bottom: 0.2em;
            line-height: 1.6;
        }
        .board-character {
            background-image: url("/images/icon_char/bg_char.jpeg");
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;

            width: 80px;
            height: 80px;
            overflow: hidden;
            position: relative;
            float: right;
            display: inline-block;
            border-radius: 40%;
            border: 1.5px solid #898989;

        }

        .board-character img {
            position: absolute;
            left: -1000%;
            right: -1010%;
            top: -1000%;
            bottom: -1020%;
            margin: auto;
            min-height: 100%;
            min-width: 100%;
        }


    </style>
</head>
<body>
<header id="header">헤더
</header>
<div class="container" style="margin-top:150px ;">
    <div class="card card-margin">
        <div class="search-result">
            <div class="result-body">
                <div style="width: 100%; line-height: 2; background-color: white; border-bottom: 2px solid #e6e6e6; padding-top:3px ; padding-bottom: 3px; padding: 2px 5px;">

                    <div class="notice_detail" data-id="1"
                         style="padding-left: 8px; cursor: pointer;">
                                    <span th:if="${boardType!=null && boardType!= boardType.equals('NOTICE')}"
                                          style="font-size: 20px; font-weight: 400; color: #202020; line-height: 1;"><a
                                            th:href="@{'/board.df?boardType=NOTICE'}"
                                            style="text-decoration-line: none; color: black;">공지사항 바로가기</a><i
                                            class="fas fa-chevron-right" style="padding-left: 8px;"></i></span>
                        <span th:if="${boardType!=null && boardType== boardType.equals('NOTICE')}"
                              style="font-size: 20px; font-weight: 400; color: #202020; line-height: 1;">공지사항</span>
                        <span th:if="${boardType==null}"
                              style="font-size: 20px; font-weight: 400; color: #202020; line-height: 1;"><a
                                th:href="@{'/board.df?boardType=NOTICE'}"
                                style="text-decoration-line: none; color: black;">공지사항 바로가기</a><i
                                class="fas fa-chevron-right" style="padding-left: 8px;"></i></span>
                        <div class="dropdown custom-dropdown" style="display: inline;   float: right;">
                            <a th:href="@{/board/insert.df(request=add)}"
                               data-offset="-70, 20"
                               style="text-decoration-line: none ;color: black;" sec:authorize="isAuthenticated()">
                                <span class="fa fa-pencil-square-o" aria-hidden="true"></span> 글쓰기
                            </a>
                            <a data-toggle="modal"
                               data-target="#loginModal" href="#"
                               data-offset="-70, 20"
                               style="text-decoration-line: none ;color: silver;" sec:authorize="!isAuthenticated()">
                                <span class="fa fa-pencil-square-o" aria-hidden="true"></span> 글쓰기
                            </a>
                            <a href="#" data-toggle="dropdown"
                               class="align-items-center dropdown-link " aria-haspopup="true"
                               aria-expanded="false" th:if="${boardType==null}" data-offset="-70, 20"
                               style="text-decoration-line: none ;color: black;">
                                <span class="fa fa-user-circle-o"></span> 통합
                                <span class="arrow icon-keyboard_arrow_down"></span>
                            </a>
                            <a href="#" data-toggle="dropdown"
                               class="align-items-center dropdown-link " aria-haspopup="true"
                               aria-expanded="false" th:if="${boardType!=null && boardType.equals('NOTICE')}"
                               data-offset="-70, 20" style="text-decoration-line: none ;color: black;">
                                                    <span
                                                            class="fa fa-bell-o"></span> 공지
                                <span class="arrow icon-keyboard_arrow_down"></span>
                            </a>
                            <a href="#" data-toggle="dropdown"
                               class="align-items-center dropdown-link " aria-haspopup="true"
                               aria-expanded="false" th:if="${boardType!=null && boardType.equals('FREE')}"
                               data-offset="-70, 20" style="text-decoration-line: none ;color: black;">
                                                    <span
                                                            class="fa fa-comments-o"></span> 자유
                                <span class="arrow icon-keyboard_arrow_down"></span>
                            </a>
                            <a href="#" data-toggle="dropdown"
                               class="align-items-center dropdown-link " aria-haspopup="true"
                               aria-expanded="false" th:if="${boardType!=null && boardType.equals('RECRUITMENT')}"
                               data-offset="-70, 20" style="text-decoration-line: none ;color: black;">
                                                    <span
                                                            class="fa fa-users"></span> 구인
                                <span class="arrow icon-keyboard_arrow_down"></span>
                            </a>
                            <a href="#" data-toggle="dropdown"
                               class="align-items-center dropdown-link " aria-haspopup="true"
                               aria-expanded="false" th:if="${boardType!=null && boardType.equals('MARKET')}"
                               data-offset="-70, 20" style="text-decoration-line: none ;color: black;">
                                                    <span
                                                            class="fa fa-money"></span> 거래
                                <span class="arrow icon-keyboard_arrow_down"></span>
                            </a>
                            <a href="#" data-toggle="dropdown"
                               class="align-items-center dropdown-link " aria-haspopup="true"
                               aria-expanded="false" th:if="${boardType!=null && boardType.equals('QUESTION')}"
                               data-offset="-70, 20" style="text-decoration-line: none ;color: black;">
                                                    <span
                                                            class="fa fa-question-circle-o"></span> 질문
                                <span class="arrow icon-keyboard_arrow_down"></span>
                            </a>
                            <a href="#" data-toggle="dropdown"
                               class="align-items-center dropdown-link " aria-haspopup="true"
                               aria-expanded="false" th:if="${boardType!=null && boardType.equals('REPORT')}"
                               data-offset="-70, 20" style="text-decoration-line: none ;color: black;">
                                                    <span
                                                            class="fa fa-hand-fist"></span> 사건/사고
                                <span class="arrow icon-keyboard_arrow_down"></span>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="z-index: 1000">
                                <a class="dropdown-item" th:href="@{'/board.df?boardType=NOTICE'}"> <span
                                        class="fa fa-bell-o"></span> 공지사항</a>
                                <a class="dropdown-item" th:href="@{'/board.df?boardType=FREE'}"><span
                                        class="fa fa-comments-o"></span> 자유게시판</a>
                                <a class="dropdown-item" th:href="@{'/board.df?boardType=RECRUITMENT'}"><span
                                        class="fa fa-users"></span> 구인게시판</a>
                                <a class="dropdown-item" th:href="@{'/board.df?boardType=MARKET'}"><span
                                        class="fa fa-money"></span> 거래게시판</a>
                                <a class="dropdown-item" th:href="@{'/board.df?boardType=QUESTION'}"><span
                                        class="fa fa-question-circle-o"></span> 질문 답변</a>
                                <a class="dropdown-item" th:href="@{'/board.df?boardType=REPORT'}"><span
                                        class="fa fa-hand-fist"></span> 사건/사고</a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div th:each="best : ${bestArticles}" style="padding: 2px 13px;">
                <a style="text-decoration-line: none" th:href="@{'/board/'+${best.id}+'.df'}">
                    <span class="badge bg-secondary " style="display:inline">베스트</span>
                    <span style="font-size: 16px; font-weight: 400; color: #202020; line-height: 1; display:inline;margin-left:4px"
                          th:text="${best.boardTitle}">공지사항 바로가기
                </span>
                    <i class="far fa-thumbs-up" style="margin-left:5px; margin-right: 6px; color: #999999;"></i><span
                        style="font-size: 12px; color: grey; font-weight: 500; display: inline"
                        th:text="${best.boardLikeCount}">0</span>
                    <div style="float:right; display:inline-block; margin-top:-6px;"><img class="boardIcon" src=""
                                                                                          style="border-radius: 50%; border: 1px solid #898989; display:inline"
                                                                                          width="20px"
                                                                                          height="20px"
                                                                                          th:src="@{/api/getFile.df(name=${best.getUserAccount().profileIcon().fileName()})}"/>
                        <span style="padding-left: 10px; padding-right: 10px; color: #4C4C4C; font-size: 14px; font-weight: 600; padding-top: 2px; display:inline"
                              th:text="${best.getUserAccount().nickname()}">테스트</span> <span
                                class="badge bg-secondary text-black-50"
                                th:text="${best.getBoardType(best.getBoardType())}"
                                th:if="${best.boardType.name().equals('FREE')}"
                                style="margin-top: 10px; margin-left:10px">자유게시판</span>
                        <span class="badge bg-warning text-black-50"
                              th:text="${best.getBoardType(best.getBoardType())}"
                              th:if="${best.boardType.name().equals('NOTICE')}" style="margin-top: 10px;">자유게시판</span>
                        <span class="badge bg-success text-white-50"
                              th:text="${best.getBoardType(best.getBoardType())}"
                              th:if="${best.boardType.name().equals('MARKET')}" style="margin-top: 10px; ">자유게시판</span>
                        <span class="badge bg-dark text-white-50"
                              th:text="${best.getBoardType(best.getBoardType())}"
                              th:if="${best.boardType.name().equals('RECRUITMENT')}"
                              style="margin-top: 10px; ">자유게시판</span>
                        <span class="badge bg-light text-black-50"
                              th:text="${best.getBoardType(best.getBoardType())}"
                              th:if="${best.boardType.name().equals('QUESTION')}"
                              style="margin-top: 10px; ">자유게시판</span>
                        <span class="badge bg-danger text-black-50"
                              th:text="${best.getBoardType(best.getBoardType())}"
                              th:if="${best.boardType.name().equals('REPORT')}" style="margin-top: 10px; ">자유게시판</span>
                    </div>
                </a>
                <div class="bar"
                     style="width: 108%; height: 2px; background-color: #e6e6e6; margin-top:5px; margin-left:-15px"></div>
            </div>

            <div style="width:100%;">
                <div style="background-color: white;">


                    <div style="padding: 10px 20px 0px;">
                        <a style="text-decoration-line: none" th:href="@{/board.df(boardType=${article.boardType})}">
                                                    <span class="badge bg-secondary text-black-50"
                                                          th:text="${article.getBoardType(article.getBoardType())}"
                                                          th:if="${article.boardType.name().equals('FREE')}">자유게시판</span>
                            <span class="badge bg-warning text-black-50"
                                  th:text="${article.getBoardType(article.getBoardType())}"
                                  th:if="${article.boardType.name().equals('NOTICE')}">자유게시판</span>
                            <span class="badge bg-success text-white-50"
                                  th:text="${article.getBoardType(article.getBoardType())}"
                                  th:if="${article.boardType.name().equals('MARKET')}">자유게시판</span>
                            <span class="badge bg-dark text-white-50"
                                  th:text="${article.getBoardType(article.getBoardType())}"
                                  th:if="${article.boardType.name().equals('RECRUITMENT')}">자유게시판</span>
                            <span class="badge bg-light text-black-50"
                                  th:text="${article.getBoardType(article.getBoardType())}"
                                  th:if="${article.boardType.name().equals('QUESTION')}">자유게시판</span>
                            <span class="badge bg-danger text-black-50"
                                  th:text="${article.getBoardType(article.getBoardType())}"
                                  th:if="${article.boardType.name().equals('REPORT')}">자유게시판</span></a>
                        <div th:each="hashtag : ${article.hashtags}" style="display: inline-block">
                            <a style="text-decoration-line: none" href="#"
                               th:href="@{/board.df(searchType=hashtag,keyword=${hashtag.name})}">
                                <span class="badge bg-info text-black"
                                      th:text="'#'+${hashtag.name}">#해시태그1</span></a>
                        </div>
                        <a style="text-decoration-line: none" href="#"
                           th:href="@{/board.df(searchType='characterName',keyword=${article.character.characterName})}"
                           th:if="${article.character!=null}">
                            <i class="fa fa-plug" style="color: black; margin-left:2px"
                               th:if="${article.character!=null}"></i>
                            <span class="badge bg-transparent text-black" th:if="${article.character!=null}"
                                  th:text="${article.character.characterName}" style="margin-left: -9px"> 캐릭터</span></a>
                        <div class="board-character" th:if="${article.character!=null}"
                             style="margin-right: 10px; margin-top:10px">
                            <img th:src="@{'https://img-api.neople.co.kr/df/servers/'+${article.character.serverId}+'/characters/'+${article.character.characterId}+'?zoom=1'}"
                                 src=""
                            >
                        </div>
                        <div class="board-character" th:if="${article.character==null}"
                             style="margin-right: 10px; margin-top:10px">
                            <i class="fa fa-user"
                               style="font-size: 50px; color: white; margin-left:18px; margin-top:2px"></i>
                            <div style="font-size: 20px; font-weight: 500; color: #999999; margin-left:22px"></div>
                        </div>

                    </div>

                    <div style="padding: 10px 20px 20px;">
                        <span style="font-size: 24px; color: #202020;" class="boardTitle"
                              th:text="${article.boardTitle}">엔트법석질문421421214214</span><br>


                        <div class="" style="padding-bottom:10px; padding-top:5px; width: 100%;">
                            <img class="boardIcon" data-icon="0" style="border-radius: 50%; border: 1px solid #898989;"
                                 src="" width="25px" height="25px"
                                 th:src="@{/api/getFile.df(name=${article.getUserAccount().profileIcon().fileName()})}"/>
                            <span class="userNick"
                                  style="padding-left: 5px; padding-right: 10px; color: #4C4C4C; font-size: 14px; font-weight: 600; padding-top: 2px;"
                                  th:text="${article.userAccount.nickname()}">만능초밥</span>
                            <span style="color: #4C4C4C; font-size: 16px; padding-top: 2px;"
                                  th:text="${article.getCreatedAt()}">2023-01-13 20:55</span>
                            <input type="hidden" th:value="${article.id}" id="boardId">
                        </div>
                        <div class="row"
                             style=" height: 2px; width: 109%; background: #e8e8e8; margin-top: 10px; margin-bottom: 10px; margin-left: -20px"></div>
                        <div style="padding-bottom:30px;">
                            <div style="display: inline-block; cursor: pointer" id="likeLogFalse" onclick="likeBoard()">
                                    <i class="far fa-thumbs-up" style="margin-right: 6px; color: #999999;"></i><span
                                        style="font-size: 12px; color: #999999; font-weight: 500; display: inline ;margin-right:6px"
                                        th:text="${article.boardLikeCount}" id="likeCountFalse">0</span></div>
                            <div style="display: inline-block; cursor: pointer" id="likeLogTrue" onclick="likeBoard()" >
                                    <i class="far fa-thumbs-up" style="margin-right: 6px; color: black;"></i><span
                                        style="font-size: 12px; color: black; font-weight: 500; display: inline ;margin-right:6px"
                                        th:text="${article.boardLikeCount}" id="likeCountTrue">0</span></div>
                            <i class="far fa-eye" style="margin-right: 6px; color: black;"></i><span
                                style="font-size: 12px; color: black; font-weight: 500; display: inline"
                                th:text="${article.boardViewCount}">0</span>
                            <input id="likeLog" th:value="${likeLog}" type="hidden">
                            <span
                                    class="badge bg-secondary" style="float:right; display: inline-block; cursor: pointer"
                                    th:if="${article.userAccount.userId()==#authentication.name}">수정</span>

                            <span class="badge bg-danger" style="float:right; display: inline-block; margin-right: 10px; cursor: pointer"
                                  th:if="${article.userAccount.userId()==#authentication.name}"
                                  onclick="deleteArticle()">삭제</span>

                            <br>
                            <br>
                            <div id="articleContent">
                                <input type="hidden" th:utext="${article.boardContent}" id="content">
                            </div>
                        </div>
                    </div>
                    <div class="bar"
                         style="width: 100%; height: 2px; background-color: #e6e6e6; margin-top:5px; "></div>
                    <div class="row" style="" id="commentList">
                        <div class="col-sm-12 col-md-12 col-xl-12 col-lg-12" style="padding: 10px;">
                            <div style="display:grid;background-color:white;">

                                <div style="padding:10px;margin-left:1%" th:each="comment : ${article.boardComments}">
                                    <div style="">
                                        <a style="color:#898989"><img class="userIcon"
                                                                      style="border:1px solid #BDBDBD;border-radius:20px;"
                                                                      width="30px" height="30px" data-icon="0"/>
                                            <span class="text-black-50" data-id=""
                                                  th:text="${comment.getUserAccount().nickname()}">모험가11452</span>
                                        </a>
                                        <span class="badge bg-secondary"
                                              style="float:right; display: inline-block; margin-right: 10px"
                                              th:if="${comment.userAccount.userId()==#authentication.getName()}"
                                              onclick="updateComment()">수정</span>

                                        <span class="badge bg-danger"
                                              style="float:right; display: inline-block; margin-right: 10px"
                                              th:if="${comment.userAccount.userId()==#authentication.getName()}"
                                              onclick="deleteComment()">삭제</span>
                                    </div>
                                    <div style="margin-left:3%;">
                                        <div style="display:flex;padding:5px;">
                                            <span style="padding:10px;border-radius:20px;background-color: silver;">테스트</span>
                                        </div>
                                        <div style="display:flex;padding:5px;">
                                            <input style="padding:8px;border-radius:20px;background-color: silver;"
                                                   value="테스트">
                                        </div>
                                        <span style="float:left;padding:5px; color: grey; display: inline-block">
											<a style="padding:10px;">
												5분전
											</a>
										</span>
                                        <span style="float:right;padding:5px 10px; " class="badge bg-dark">
											<a style="padding:10px;">
												답글
											</a>
										</span>
                                        <span style="float:right;padding:5px 10px; " class="badge bg-success">
											<a style="padding:10px;">
												수정
											</a>
										</span>
                                    </div>
                                </div>


                            </div>

                            <div class="bar" style="width: 100%; height: 2px; background-color: #e6e6e6;"></div>
                            <div class="row" style="text-align: center;padding-left: 30px; padding-right: 30px;">
                            </div>
                        </div>
                    </div>
                    <input hidden th:if="${#authentication!=null}" th:value="${#authentication.getName()}"
                           id="principalId">
                    <div style="background-color: #F2F2F2">

                        <div class="">
                            <div class="input-group" style="padding:15px;">
                                            <textarea class="form-control" id="comment"
                                                      style="min-height: 50px; max-height: 100px; overflow-y: hidden;"
                                                      placeholder="댓글을 입력해주세요."></textarea>
                                <span class="input-group-addon text-center" id="commentSave"  onclick="commentSave()"
                                      style="cursor: pointer; padding:2rem;"><i class="fa fa-comment"
                                                                  style="margin-left: -5px; scale:1.5"></i></span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <footer id="footer">푸터
            </footer>
            <script src="/header/js/jquery.sticky.js"></script>
            <script src="/header/js/main.js"></script>
            <script src="https://code.jquery.com/jquery-3.6.1.js"></script>
            <!-- Popper JS -->
            <script src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js'></script>
            <!-- Bootstrap JS -->
            <script src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js'></script>
            <script src="/js/scriptfile.js"></script>
            <script src="/js/choices.js"></script>

</body>
<script>
    $(document).ready(function () {
        const viewer = toastui.Editor.factory({
            el: document.querySelector("#articleContent"),
            viewer: true,

            height: "500px",
            initialValue: document.getElementById("content").value,
        });
        if ($("#likeLog").val() === "true") {
            $("#likeLogTrue").show();
            $("#likeLogFalse").hide();
        } else {
            $("#likeLogTrue").hide();
            $("#likeLogFalse").show();
        }
        getBoardComment($('#boardId').val());
    });

    function getBoardComment(boardId) {

        $('#commentList').empty();
        var html = "";

        $.ajax({
            url: "/api/comment.df",
            type: "GET",
            data: {
                boardId: boardId
            },
            success: function (data) {
                console.log(data);
                $(data).each(function () {
                    if (this.isParent === 'Y') {
                        html += "<div style='padding:10px; width:95%'>";
                        html += "<div style='margin-left:4%;'>";
                        html += "<a style='color:#898989'><img class='boardIcon' style='border:1px solid #BDBDBD;border-radius:20px;' width='30px' height='30px' src='/api/getFile.df?name=" + this.userAccount.profileIcon.fileName + "'/>";
                        html += "<span style='margin-left:2%' class='text-black-50' data-id='" + this.id + "'>" + this.userAccount.nickname + "</span>";
                        html += "</a>";
                        if (this.userAccount.userId === $("#principalId").val()) {
                            html += "<span class='badge bg-transparent text-black' id='"+this.id+"-update' style=' display: inline-block; margin-left: 2% ; cursor: pointer'  onclick='updateComment(" + this.id + ")'><i class='fa fa-pencil' style='margin-right:10%'></i>  수정</span>";
                            html += "<span class='updateBtn badge bg-transparent text-black' id='"+this.id+"-updateCheck' style=' display: inline-block; margin-left: 2%; cursor: pointer'  onclick='updateCommentCheck(" + this.id + ")'><i class='fa fa-pencil' style='margin-right:10%'></i>  수정하기</span>";
                            html += " <span class='badge bg-transparent text-black' id='"+this.id+"-delete' style='display: inline-block; cursor: pointer'  onclick='deleteComment(" + this.id + ")'><i class='fa fa-trash-o' style='margin-right:10%'></i> 삭제</span>";
                            html += " <span class='updateCancelBtn badge bg-transparent text-black' id='"+this.id+"-updateCancel' style='display: inline-block; cursor: pointer '  onclick='updateCancel(" + this.id + ")'><i class='fa fa-times' style='margin-right:10%'></i> 취소</span>";

                        }
                        html += "</div>";
                        html += "<div style='margin-left:3%; margin-top:1%'>";
                        html += "<div style='display:flex;'>";
                        html += "<span style='padding:10px;border-radius:20px;background-color: lightgrey; margin-left:1% ; white-space: pre-wrap; display: flex' id='" + this.id + "-content'>" + this.commentContent + "</span>";
                        html += "<textarea class='updateInput'   style='padding:10px;border-radius:20px;background-color: transparent; margin-left:1%; width:90%' id='" + this.id + "-contentInput'></textarea>";
                        html += "</div>";
                        html += "<div style='display:flex;' >";
                        html += "</div>";
                        html += "<span style='float:left;padding:5px; ; color: grey; display: inline-block'>";
                        html += "<a style='padding:10px;'>";
                        html += this.createdAt
                        html += "</a>";
                        html += "</span>";
                        html += "<span style=' margin-top:8px; cursor:pointer' class='badge bg-transparent text-black' onclick='commentReplyForm("+this.id+")'  id='"+this.id+"-replyFormBtn'>";
                        html += "<i class='fa fa-comments-o' style='margin-right:10%' aria-hidden='true'></i>"
                        html += " 답글 : " + this.childrenComments.length + "개";
                        html += "</span>";
                        html += "<span style=' margin-top:8px; cursor:pointer' class='badge bg-transparent text-black refreshBtn' onclick='commentReplyForm("+this.id+")' id='"+this.id+"-refreshBtn' >";
                        html += "<i class='fa fa-refresh' style='margin-right:10%;' aria-hidden='true'></i>"
                        html += "새로고침";
                        html += "</span>";
                        html += "<span class='badge bg-transparent text-black' style='cursor: pointer'>";
                        html += "<i class='fa fa-heart-o' style='margin-right: 5px; '  aria-hidden='true'></i>"
                        html += this.commentLikeCount;
                        html += "</div>";
                        html += "</div>";
                        html += "<div id='"+this.id+"-replyCommentForm' style='margin-left:10px' class='replyForm'>";
                        html += "</div>";
                    }
                })
            },
            error: function (e) {
                console.log(e);
            }
        }).done(function () {
            $("#commentList").html(html);
            $(".updateInput").hide();
            $(".updateBtn").hide();
            $(".updateCancelBtn").hide();
            $(".replyForm").hide();
            $(".refreshBtn").hide();
        });
    }
    function replyCommentCancel(id) {
        $("#" + id + "-replyFormBtn").show();
        $("#" + id + "-refreshBtn").hide();
        $("#"+id+"-replyCommentForm").hide();
    }

    function replyCommentCheck(id) {
        var commentContent = $("#"+id+"-replyInput").val();
        const data = {
            boardId: $("#boardId").val(),
            commentContent: commentContent,
            commentId: id
        }
        $.ajax({
            url: "/api/comment.df?mode=children",
            type: "POST",
            data: JSON.stringify(data),
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                console.log(data);
                alert("등록되었습니다.")
                commentReplyForm(id);
            },
            error: function (e) {
                console.log(e);
            }
        });
    }

    function commentReplyForm(id) {
        $('#'+id+'-replyFormBtn').hide();
        $('#'+id+'-refreshBtn').show();
        $("#"+id+"-replyCommentForm").empty();
        var html = "";
        html += "<textarea    style='padding:10px;border-radius:20px;background-color: transparent; margin-left:5%; width:85%' id='" + id + "-replyInput'></textarea>";
        html += "<div style='margin-left:5%; margin-top:1%; display: flex; margin-bottom: 10px' >";
        html += "<a style='text-decoration-line: none;' href='#' onclick='replyCommentCheck(" + id + ")'>"
        html += "<span class='badge bg-transparent text-black' style='margin-left:5px;'> <i class='fa fa-comment-o' style='margin-left:1%; margin-right:20%;' ></i>등록</span></a>";
        html += "<a style='text-decoration-line: none' href='#' onclick='replyCommentCancel(" + id + ")'>";
        html += "<span class='badge bg-transparent text-black' style='margin-left:5px; '><i class='fa fa-times' style='margin-left:2%; margin-right:20%' ></i>답글 접기</span></a>";
        html += "</div>";
        $.ajax({
            url: "/api/comment.df",
            data: {
                boardId : $("#boardId").val(),
                commentId: id
            },
            type: "GET",
            success: function (result) {
                $('#'+id+'-replyFormBtn').html("<i class='fa fa-comments-o' style='margin-right:10%' aria-hidden='true'></i>답글 : " + result.length + "개");
                console.log(result);
                $(result).each(function(){
                    if(this.isParent==='N'){
                        html += "<div style='padding:10px; width:95%'>";
                        html += "<div style='margin-left:4%;'>";
                        html += "<a style='color:#898989'><img class='boardIcon' style='border:1px solid #BDBDBD;border-radius:20px;' width='30px' height='30px' src='/api/getFile.df?name=" + this.userAccount.profileIcon.fileName + "'/>";
                        html += "<span style='margin-left:2%' class='text-black-50' data-id='" + this.id + "'>" + this.userAccount.nickname + "</span>";
                        html += "</a>";
                        if (this.userAccount.userId === $("#principalId").val()) {
                            html += "<span class='badge bg-transparent text-black' id='"+this.id+"-update' style=' display: inline-block; margin-left: 2% ; cursor: pointer'  onclick='updateComment(" + this.id + ")'><i class='fa fa-pencil' style='margin-right:10%'></i>  수정</span>";
                            html += "<span class='updateBtn badge bg-transparent text-black' id='"+this.id+"-updateCheck' style=' display: inline-block; margin-left: 2%; cursor: pointer'  onclick='updateCommentCheck(" + this.id + ")'><i class='fa fa-pencil' style='margin-right:10%'></i>  수정하기</span>";
                            html += " <span class='badge bg-transparent text-black' id='"+this.id+"-delete' style='display: inline-block; cursor: pointer'  onclick='deleteComment(" + this.id + ")'><i class='fa fa-trash-o' style='margin-right:10%'></i> 삭제</span>";
                            html += " <span class='updateCancelBtn badge bg-transparent text-black' id='"+this.id+"-updateCancel' style='display: inline-block; cursor: pointer '  onclick='updateCancel(" + this.id + ")'><i class='fa fa-times' style='margin-right:10%'></i> 취소</span>";

                        }
                        html += "</div>";
                        html += "<div style='margin-left:3%; margin-top:1%'>";
                        html += "<div style='display:flex;'>";
                        html += "<span style='padding:10px;border-radius:20px;background-color: lightgrey; margin-left:1% ; white-space: pre-wrap; display: flex' id='" + this.id + "-content'>" + this.commentContent + "</span>";
                        html += "<textarea class='updateInput'   style='padding:10px;border-radius:20px;background-color: transparent; margin-left:1%; width:90%' id='" + this.id + "-contentInput'></textarea>";
                        html += "</div>";
                        html += "<div style='display:flex;' >";
                        html += "</div>";
                        html += "<span style='float:left;padding:5px; ; color: grey; display: inline-block'>";
                        html += "<a style='padding:10px;'>";
                        html += this.createdAt
                        html += "</a>";
                        html += "</span>";
                        html += "<span class='badge bg-transparent text-black' style='cursor: pointer; margin-top:7px'>";
                        html += "<i class='fa fa-heart-o' style='margin-right: 5px;  '  aria-hidden='true'></i>"
                        html += this.commentLikeCount;
                        html += "</div>";
                        html += "</div>";
                    }
                })
                $("#"+id+"-replyCommentForm").html(html);
                $("#"+id+"-replyCommentForm").show();
                $(".updateInput").hide();
                $(".updateBtn").hide();
                $(".updateCancelBtn").hide();

            },
            error: function (e) {
                console.log(e);
            }
        });

    }


    function commentLike() {
        alert('테스트');
    }

    function updateComment(commentId) {
        var content = $("#" + commentId + "-content").text();
        $("#" + commentId + "-content").hide();
        $("#" + commentId + "-contentInput").show();
        $("#" + commentId + "-contentInput").val(content);
        $("#" + commentId + "-update").hide();
        $("#" + commentId + "-delete").hide();
        $("#" + commentId + "-updateCheck").show();
        $("#" + commentId + "-updateCancel").show();
    }

    function updateCancel(commentId) {

        $("#" + commentId + "-content").show();
        $("#" + commentId + "-contentInput").hide();
        $("#" + commentId + "-update").show();
        $("#" + commentId + "-delete").show();
        $("#" + commentId + "-updateCheck").hide();
        $("#" + commentId + "-updateCancel").hide();
    }

    function updateCommentCheck(commentId){
        if(confirm("수정하시겠습니까?")) {
            var content = $("#" + commentId + "-contentInput").val();
            const boardId= $('#boardId').val();
            const data = {
                commentId: commentId,
                commentContent: content,
                boardId: boardId
            }
            $.ajax({
                url: "/api/comment.df",
                type: "PUT",
                data: JSON.stringify(data),
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    alert("수정되었습니다.")
                    getBoardComment(boardId);
                },
                error: function (e) {
                    console.log(e);
                }
            });
        }
    }

    function deleteComment(commendId) {
        if(confirm("삭제하시겠습니까?")) {
            $.ajax({
                url: "/api/comment.df",
                type: "DELETE",
                data: {
                    commentId: commendId
                },
                success: function (data) {
                    alert("삭제되었습니다.");
                    console.log(data);
                    getBoardComment($('#boardId').val());
                },
                error: function (e) {
                    console.log(e);
                }
            });
        }
    }

    function commentSave() {
        const content = $("#comment").val();
        const boardId = $("#boardId").val();
        const data = {
            commentContent: content,
            boardId: boardId
        };
        $.ajax({
            url: "/api/comment.df",
            type: "POST",
            data: JSON.stringify(data),
            contentType: "application/json; charset=utf-8",
            success: function (success) {
                console.log(success);
                alert('댓글 작성 완료');
                $('#comment').val('');
                getBoardComment($('#boardId').val());
            },
            error: function (e) {
                console.log(e);
            }
        });
    }


    function deleteArticle() {
        if (confirm("삭제하시겠습니까?")) {
            $.ajax({
                url: "/api/board.df",
                type: "delete",
                data: {
                    id: $("#boardId").val()
                },
                success: function (data) {
                    alert("삭제되었습니다.");
                    location.href = "/board.df";
                },
                error: function (request, status, error) {
                    alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                }
            });
        }
    }

    function likeBoard() {
        const boardId = $("#boardId").val();
        $.ajax({
            url: "/api/like.df",
            type: "POST",
            data: {
                boardId: boardId
            },
            success: function (data) {
                $("#likeLogTrue").toggle();
                $("#likeLogFalse").toggle();
                $("#likeLog").val("true");
                $("#likeCountTrue").text(data);
                $("#likeCountFalse").text(data);
            },
            error: function (request, status, error) {
                alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
            }
        });
    }

</script>
</html>