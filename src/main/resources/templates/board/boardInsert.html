<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet"/>
    <link href="/css/searchForm.css" rel="stylesheet"/>
    <link href="/Login/assets/css/bootstrap.css" rel="stylesheet"/>
    <meta charset="UTF-8">
    <script src="https://kit.fontawesome.com/1d4d31d2f3.js" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="/Login/assets/css/login-register.css" rel="stylesheet"/>
    <link href="/Login/assets/css/main.css" rel="stylesheet"/>
    <link rel="stylesheet" href="/css/owl.carousel.min.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/header/fonts/icomoon/style.css">

    <link rel="stylesheet" href="/header/css/owl.carousel.min.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/header/css/bootstrap.min.css">
    <!-- Style -->
    <link rel="stylesheet" href="/header/css/style.css">
    <link rel="stylesheet" href="/header/css/style.css">
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <script src="/Login/assets/js/bootstrap.js" type="text/javascript"></script>
    <script src="/Login/assets/js/login-register.js" type="text/javascript"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.3.1/css/all.css'>
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <!-- TOAST UI Editor CDN(CSS) -->
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <title>던파모아 온오프</title>
</head>
<body>
<header id="header">
  헤더
</header>
<div style="margin-top:92px ;" class="container">
    <div class="row" style="padding-top: 3%;">
        <form method="post" >
            <h5 class="my-3 border-bottom pb-2">게시글 등록하기</h5>
            <div class="s003" style="float:right; display:inline-block">
                    <div class="input-field first-wrap">
                        <div class="input-select">
                            <select data-trigger="" name="boardType" id="boardType">
                                <option value="FREE">자유</option>
                                <option value="RECRUITMENT">구인</option>
                                <option value="MARKET">거래</option>
                                <option value="QUESTION">질문</option>
                            </select>
                        </div>
                    </div>
            </div>
            <div class="mb-3">
                <label for="title" class="form-label" style="display: inline-block">제목</label>
                <input type="text"   placeholder="제목을 입력해주세요" name="title" id="title" class="form-control">
            </div>
            <div class="field-error"></div>
            <div class="mb-3">
                <label class="form-label">내용</label>
                <div id="editor1"></div>
            </div>
            <div class="mb-3" style="width:200px">
                <label for="hashtag" class="form-label">태그</label>
                <input type="text" name="hashtag" id="hashtag" class="form-control">
            </div>
            <button type="button" onclick="uploadArticle()" class="btn btn-primary my-2">등록</button>
        </form>
        </div>
            </div>


<footer id="footer">
  푸터
</footer>
<script src="/header/js/jquery.sticky.js"></script>
<script src="/header/js/main.js"></script>
<script src="https://code.jquery.com/jquery-3.6.1.js"></script>
<!-- Popper JS -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js'></script>
<!-- Bootstrap JS -->
<script src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js'></script>
<script src="/js/scriptfile.js"></script>
<script src="/js/choices.js"></script>

</body>
<script>
    $(document).ready(function(){
        fileIds ="";
    });
    var fileIds = "";
    function uploadArticle(){

        const title = $('#title').val();
        const hashtag = $('#hashtag').val();
        const boardType = $('#boardType').val();
        const data = {
            boardTitle: title,
            boardContent: editor.getHTML(),
            hashtag: hashtag,
            boardFiles : fileIds,
            boardType: boardType
        }
        $.ajax({
            type: "POST",
            url: "/api/board.df",
            data: JSON.stringify(data),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
                alert("등록되었습니다.")
                location.href= "/boardList/"+response;
            },
            error: function (request, status, error) {
                alert(request.responseText);
            }
        });
    }


    const editor = new toastui.Editor({
        el: document.querySelector('#editor1'),
        initialEditType: 'markdown',
        previewStyle: 'vertical',
        height: '500px',
        initialValue: '',
        events: {
            change: function () {
                console.log(editor.getMarkdown());
            }
        },
        hooks: {
            addImageBlobHook: (blob, callback) => {
                // blob : Java Script 파일 객체
                //console.log(blob);

                const formData = new FormData();
                formData.append('file', blob);

                let url = '/api/getFile.df?name=';
                $.ajax({
                    type: 'POST',
                    enctype: 'multipart/form-data',
                    url: '/api/upload.df',
                    data: formData,
                    dataType: 'json',
                    processData: false,
                    contentType: false,
                    cache: false,
                    timeout: 600000,
                    success: function(data) {
                        //console.log('ajax 이미지 업로드 성공');
                        url += data.fileName;
                        fileIds += data.id + ",";
                        // callback : 에디터(마크다운 편집기)에 표시할 텍스트, 뷰어에는 imageUrl 주소에 저장된 사진으로 나옴
                        // 형식 : ![대체 텍스트](주소)
                        callback(url, '사진 대체 텍스트 입력');
                    },
                    error: function(e) {
                        //console.log('ajax 이미지 업로드 실패');
                        //console.log(e.abort([statusText]));

                        callback('image_load_fail', '사진 대체 텍스트 입력');
                    }
                });
            }
        }
    });

    const choices = new Choices('[data-trigger]',
        {
            searchEnabled: false,
            itemSelectText: '',
        });

</script>
</html>